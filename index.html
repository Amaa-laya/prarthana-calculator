<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NSB Savings Calculator</title>
  <style>
    /* Color variables */
    :root {
      --nsb: #f58220;
      --grey: #e0e0e0;
      --blue: #1976d2;
      --dark: #444;
      --bg-light: #f5f5f5;
      --bg-dark: #1e1e1e;
      --text-light: #000;
      --text-dark: #fff;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: var(--bg-light);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      min-height: 100vh;
      padding-top: 60px;
      transition: background 0.3s ease, color 0.3s ease;
    }
    body.dark-mode {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.1);
      max-width: 960px;
      width: 100%;
    }
    body.dark-mode .container {
      background: #2c2c2c;
    }
    h2 {
      text-align: center;
      color: var(--nsb);
      margin-bottom: 20px;
    }
    .hamburger {
      position: fixed;
      top: 16px;
      left: 16px;
      font-size: 28px;
      background: #fff;
      color: var(--nsb);
      padding: 6px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      user-select: none;
      z-index: 1100;
    }
    .sidebar {
      position: fixed;
      left: -260px;
      top: 0;
      width: 260px;
      height: 100%;
      background: var(--nsb);
      padding-top: 60px;
      transition: left 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }
    .sidebar.open {
      left: 0;
    }
    .sidebar a {
      display: block;
      padding: 16px 24px;
      color: #fff;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
    }
    .sidebar a:hover {
      background: #e06d0f;
    }
    .sidebar .dark-toggle {
      display: block;
      padding: 16px 24px;
      background: #222;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      text-align: center;
    }
    /* NSB logo styling */
    .nsb-logo {
      text-align: center;
      margin-bottom: 16px;
    }
    .nsb-logo img {
      width: 80px;
      height: auto;
    }
    .tabs {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 18px;
      gap: 8px;
    }
    .tab {
      background: var(--grey);
      padding: 10px 24px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      user-select: none;
      font-weight: bold;
      color: var(--dark);
    }
    .tab.active {
      background: var(--nsb);
      color: #fff;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    form {
      border: 2px solid var(--nsb);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 16px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 4px;
      border-radius: 6px;
      border: 1px solid #ccc;
      outline-offset: 2px;
    }
    input:focus, select:focus {
      border-color: var(--nsb);
      outline: none;
      box-shadow: 0 0 5px var(--nsb);
    }
    button {
      background-color: var(--nsb);
      color: #fff;
      border: none;
      cursor: pointer;
      margin-top: 10px;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #e06d0f;
    }
    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .button-row button {
      flex: 1;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      color: var(--blue);
      white-space: pre-wrap;
    }
    .toolbar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
      align-items: center;
      gap: 10px;
    }
    .sound-icon {
      font-size: 28px;
      cursor: pointer;
      color: var(--blue);
      user-select: none;
      transition: color 0.3s ease;
    }
    .sound-icon.off {
      color: var(--dark);
      opacity: 0.5;
    }
    .language-toggle {
      font-size: 12px;
      background: var(--grey);
      padding: 4px 8px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      user-select: none;
      width: auto;
    }
    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      input, button, select {
        font-size: 16px;
        width: 100%;
        margin-bottom: 10px;
      }
      .tabs {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- Hamburger icon to toggle sidebar -->
  <span class="hamburger" onclick="toggleSidebar()">☰</span>

  <!-- Sidebar navigation for product selection -->
  <nav id="sidebar" class="sidebar">
    <div class="nsb-logo">
      <img src="/assets/nsb.png" alt="NSB Logo" />
    </div>
    <a href="#" onclick="setProduct('prarthana'); toggleSidebar(); return false;">Prarthana</a>
    <a href="#" onclick="setProduct('reality'); toggleSidebar(); return false;">Reality</a>
    <span class="dark-toggle" onclick="toggleDarkMode()">🌓 Dark Mode</span>
  </nav>

  <div class="container">
    <!-- Title changes based on product & language -->
    <h2 id="title">NSB Prarthana Savings Calculator</h2>

    <div class="toolbar">
      <!-- Language toggle button -->
      <button class="language-toggle" onclick="toggleLanguage()" id="langBtn">සිංහල</button>
      <!-- Sound toggle icon -->
      <span id="soundIcon" class="sound-icon" onclick="toggleSound()">🔊</span>
    </div>

    <!-- Tabs for calculator forms -->
    <div class="tabs">
      <div class="tab active" id="tabRequired" onclick="showTab('required')">🪙 Required Deposit</div>
      <div class="tab" id="tabMaturity" onclick="showTab('maturity')">💰 Maturity Value</div>
    </div>

    <!-- Required Deposit Form -->
    <div id="required" class="tab-content active">
      <form id="formRequired" onsubmit="event.preventDefault(); calculateRequired();">
        <label for="open" id="labelOpen">Opening Date</label>
        <input id="open" type="date" required onchange="updateMaturityDate()" />

        <label for="period" id="labelPeriod">Period</label>
        <select id="period" required onchange="updateMaturityDate()"></select>

        <label for="mdate" id="labelMdate">Maturity Date</label>
        <input id="mdate" type="date" disabled />

        <label for="target" id="labelTarget">Target Amount (LKR)</label>
        <input id="target" type="number" step="0.01" min="0" required />

        <label for="rate" id="rateLabel">Interest Rate (% per year)</label>
        <input id="rate" type="number" step="0.01" min="0" required />

        <div class="button-row">
          <button type="submit" id="calcBtn">🧮 Calculate</button>
          <button type="reset" onclick="clearResult('resultRequired')" id="clearBtn">🧹 Clear</button>
          <button type="button" onclick="saveFormAsPDF('formRequired', 'resultRequired', 'NSB_Prarthana_Savings_Calculator')" id="saveBtn">💾 Save as PDF</button>
        </div>
      </form>
      <div class="result" id="resultRequired"></div>
    </div>

    <!-- Maturity Value Form -->
    <div id="maturity" class="tab-content">
      <form id="formMaturity" onsubmit="event.preventDefault(); calculateMaturity();">
        <label for="open2" id="labelOpen2">Opening Date</label>
        <input id="open2" type="date" required onchange="updateMaturityDate2()" />

        <label for="period2" id="labelPeriod2">Period</label>
        <select id="period2" required onchange="updateMaturityDate2()"></select>

        <label for="mdate2" id="labelMdate2">Maturity Date</label>
        <input id="mdate2" type="date" disabled />

        <label for="installment" id="installmentLabel">Deposit Amount (LKR)</label>
        <input id="installment" type="number" step="0.01" min="0" required />

        <label for="rate2" id="rateLabel2">Interest Rate (% per year)</label>
        <input id="rate2" type="number" step="0.01" min="0" required />

        <div class="button-row">
          <button type="submit" id="calcBtn2">🧮 Calculate</button>
          <button type="reset" onclick="clearResult('resultMaturity')" id="clearBtn2">🧹 Clear</button>
          <button type="button" onclick="saveFormAsPDF('formMaturity', 'resultMaturity', 'NSB_Reality_Savings_Calculator')" id="saveBtn2">💾 Save as PDF</button>
        </div>
      </form>
      <div class="result" id="resultMaturity"></div>
    </div>
  </div>

  <!-- jsPDF Library for saving PDFs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    let currentProduct = 'prarthana';  // "prarthana" or "reality"
    let soundOn = true;
    let currentLanguage = 'en';

    // Period options by product
    const periods = {
      prarthana: [3, 5, 10, 15, 20],   // years
      reality: [12, 24, 36, 48, 60]    // months
    };

    // Translations for labels and text
    const labels = {
      en: {
        titlePrarthana: "NSB Prarthana Savings Calculator",
        titleReality: "NSB Reality Savings Calculator",
        depositLabel: "Deposit Amount (LKR)",
        monthlyLabel: "Monthly Installment (LKR)",
        requiredTab: "Required Deposit",
        maturityTab: "Maturity Value",
        calculate: "Calculate",
        clear: "Clear",
        save: "Save as PDF",
        rate: "Interest Rate (% per year)",
        target: "Target Amount (LKR)",
        openDate: "Opening Date",
        period: "Period",
        maturityDate: "Maturity Date"
      },
      si: {
        titlePrarthana: "NSB ප්‍රාර්ථනා අරමුදල් ගණකය",
        titleReality: "NSB රියාලිටි අරමුදල් ගණකය",
        depositLabel: "තැන්පතු මුදල (රු.)",
        monthlyLabel: "මාසික වාරිකය (රු.)",
        requiredTab: "අවශ්‍ය තැන්පතු",
        maturityTab: "මූල්‍ය අගය",
        calculate: "ගණනය කරන්න",
        clear: "පිරිසිදු කරන්න",
        save: "PDF ලෙස සුරකින්න",
        rate: "පිළිබඳ පොලී අනුපාතය (වසරකට %)",
        target: "ඉලක්ක මුදල (රු.)",
        openDate: "ආරම්භක දිනය",
        period: "කාලය",
        maturityDate: "මූල්‍ය දිනය"
      }
    };

    // Sidebar toggle
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("open");
    }

    // Toggle sound on/off with speech feedback
    function toggleSound() {
      soundOn = !soundOn;
      const icon = document.getElementById("soundIcon");
      icon.classList.toggle("off", !soundOn);
      speak(soundOn ? (currentLanguage === 'en' ? "Sound On" : "ශබ්දය සක්‍රීයයි") : (currentLanguage === 'en' ? "Sound Off" : "ශබ්දය නිවැටයි"));
    }

    // Speak text using Web Speech API
    function speak(text) {
      if (!soundOn) return;
      const synth = window.speechSynthesis;
      if (synth.speaking) synth.cancel();
      const utter = new SpeechSynthesisUtterance(text);
      synth.speak(utter);
    }

    // Switch between "prarthana" and "reality" products
    function setProduct(product) {
      currentProduct = product;

      // Update title
      const lang = labels[currentLanguage];
      document.getElementById("title").innerText = product === 'prarthana' ? lang.titlePrarthana : lang.titleReality;

      // Update installment label based on product
      document.getElementById("installmentLabel").innerText = product === 'prarthana' ? lang.depositLabel : lang.monthlyLabel;

      // Reset forms and results
      document.getElementById("formRequired").reset();
      document.getElementById("formMaturity").reset();
      clearResult('resultRequired');
      clearResult('resultMaturity');

      // Populate period dropdowns for the selected product
      populatePeriods();
      updateMaturityDate();
      updateMaturityDate2();

      // Update UI labels text for current language
      updateLanguage();
    }

    // Show selected tab content and mark tab active
    function showTab(id) {
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));

      document.getElementById(id).classList.add('active');
      document.getElementById('tab' + capitalizeFirstLetter(id)).classList.add('active');
    }

    // Capitalize first letter helper
    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // Populate period select inputs depending on product
    function populatePeriods() {
      const period1 = document.getElementById("period");
      const period2 = document.getElementById("period2");
      period1.innerHTML = "";
      period2.innerHTML = "";

      periods[currentProduct].forEach(p => {
        let unit = currentProduct === 'prarthana' ? 'year' : 'month';
        let unitText = currentLanguage === 'en' ? (unit + (p > 1 ? 's' : '')) : (unit === 'year' ? 'වසර' : 'මාස');
        let optionText = `${p} ${unitText}`;

        let option1 = document.createElement("option");
        option1.value = p;
        option1.text = optionText;
        period1.appendChild(option1);

        let option2 = document.createElement("option");
        option2.value = p;
        option2.text = optionText;
        period2.appendChild(option2);
      });
    }

    // Update maturity date for Required Deposit tab
    function updateMaturityDate() {
      const openVal = document.getElementById("open").value;
      const periodVal = document.getElementById("period").value;
      if (!openVal || !periodVal) {
        document.getElementById("mdate").value = "";
        return;
      }
      let open = new Date(openVal);
      const period = parseInt(periodVal);

      if (currentProduct === 'prarthana') {
        open.setFullYear(open.getFullYear() + period);
      } else {
        open.setMonth(open.getMonth() + period);
      }
      document.getElementById("mdate").value = open.toISOString().slice(0, 10);
    }

    // Update maturity date for Maturity Value tab
    function updateMaturityDate2() {
      const openVal = document.getElementById("open2").value;
      const periodVal = document.getElementById("period2").value;
      if (!openVal || !periodVal) {
        document.getElementById("mdate2").value = "";
        return;
      }
      let open = new Date(openVal);
      const period = parseInt(periodVal);

      if (currentProduct === 'prarthana') {
        open.setFullYear(open.getFullYear() + period);
      } else {
        open.setMonth(open.getMonth() + period);
      }
      document.getElementById("mdate2").value = open.toISOString().slice(0, 10);
    }

    // Clear results text by id
    function clearResult(id) {
      document.getElementById(id).innerText = "";
    }

    // Calculation for Required Deposit tab
    function calculateRequired() {
      const target = parseFloat(document.getElementById("target").value);
      const rate = parseFloat(document.getElementById("rate").value) / 100;
      const period = parseInt(document.getElementById("period").value);

      if (isNaN(target) || isNaN(rate) || isNaN(period)) {
        alert(getText('Please enter valid inputs'));
        return;
      }

      let deposit = 0;
      if (currentProduct === 'prarthana') {
        // Compound Interest: A = P(1 + r)^t
        // So, P = A / (1 + r)^t
        deposit = target / Math.pow(1 + rate, period);
      } else {
        // For Reality (monthly periods)
        const years = period / 12;
        deposit = target / Math.pow(1 + rate, years);
      }

      deposit = deposit.toFixed(2);
      const resText = currentLanguage === 'en' 
        ? `Required Initial Deposit: LKR ${deposit}`
        : `අවශ්‍ය ආරම්භක තැන්පතුව: රු. ${deposit}`;

      document.getElementById("resultRequired").innerText = resText;
      speak(resText);
    }

    // Calculation for Maturity Value tab
    function calculateMaturity() {
      const installment = parseFloat(document.getElementById("installment").value);
      const rate = parseFloat(document.getElementById("rate2").value) / 100;
      const period = parseInt(document.getElementById("period2").value);

      if (isNaN(installment) || isNaN(rate) || isNaN(period)) {
        alert(getText('Please enter valid inputs'));
        return;
      }

      let maturityValue = 0;
      if (currentProduct === 'prarthana') {
        // Compound interest for lump sum deposit every period is 1 year.
        maturityValue = installment * Math.pow(1 + rate, period);
      } else {
        // Reality: Monthly deposits for months with compound interest yearly
        const years = period / 12;
        // Assume compounding monthly for monthly deposits
        const monthlyRate = rate / 12;
        // Future value of annuity formula: FV = P * [((1 + r)^n - 1)/r]
        maturityValue = installment * ((Math.pow(1 + monthlyRate, period) - 1) / monthlyRate);
      }

      maturityValue = maturityValue.toFixed(2);

      const resText = currentLanguage === 'en' 
        ? `Maturity Value: LKR ${maturityValue}`
        : `මූල්‍ය අගය: රු. ${maturityValue}`;

      document.getElementById("resultMaturity").innerText = resText;
      speak(resText);
    }

    // Save form inputs and result as PDF
    function saveFormAsPDF(formId, resultId, filenamePrefix) {
      const form = document.getElementById(formId);
      const resultText = document.getElementById(resultId).innerText;

      const pdf = new jsPDF();
      pdf.setFontSize(16);
      pdf.setTextColor('#f58220');
      pdf.text(filenamePrefix.replace(/_/g, ' ') , 20, 20);

      pdf.setTextColor(0);
      pdf.setFontSize(12);

      // Add all form inputs and their labels
      let y = 30;
      for (const elem of form.elements) {
        if ((elem.tagName === 'INPUT' || elem.tagName === 'SELECT') && elem.type !== 'submit' && elem.type !== 'button' && !elem.disabled) {
          const label = form.querySelector(`label[for="${elem.id}"]`);
          const labelText = label ? label.innerText : elem.name;
          const value = elem.value || '-';
          pdf.text(`${labelText}: ${value}`, 20, y);
          y += 10;
        }
      }

      y += 10;
      pdf.setTextColor('#1976d2');
      pdf.text("Result:", 20, y);
      y += 10;
      pdf.setTextColor(0);
      pdf.text(resultText || 'No result', 20, y);

      pdf.save(filenamePrefix + ".pdf");
    }

    // Toggle dark mode
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    // Toggle language and update labels
    function toggleLanguage() {
      currentLanguage = currentLanguage === 'en' ? 'si' : 'en';
      document.getElementById("langBtn").innerText = currentLanguage === 'en' ? 'සිංහල' : 'English';
      updateLanguage();
      speak(currentLanguage === 'en' ? "English language selected" : "සිංහල භාෂාව තෝරා ඇත");
    }

    // Update UI labels for current language and product
    function updateLanguage() {
      const lang = labels[currentLanguage];

      // Titles
      document.getElementById("title").innerText = currentProduct === 'prarthana' ? lang.titlePrarthana : lang.titleReality;
      document.getElementById("tabRequired").innerText = lang.requiredTab;
      document.getElementById("tabMaturity").innerText = lang.maturityTab;

      // Form 1 Labels
      document.getElementById("labelOpen").innerText = lang.openDate;
      document.getElementById("labelPeriod").innerText = lang.period;
      document.getElementById("labelMdate").innerText = lang.maturityDate;
      document.getElementById("labelTarget").innerText = currentLanguage === 'en' ? "Target Amount (LKR)" : "ඉලක්ක මුදල (රු.)";
      document.getElementById("rateLabel").innerText = lang.rate;

      // Form 2 Labels
      document.getElementById("labelOpen2").innerText = lang.openDate;
      document.getElementById("labelPeriod2").innerText = lang.period;
      document.getElementById("labelMdate2").innerText = lang.maturityDate;
      document.getElementById("installmentLabel").innerText = currentProduct === 'prarthana' ? lang.depositLabel : lang.monthlyLabel;
      document.getElementById("rateLabel2").innerText = lang.rate;

      // Buttons
      document.getElementById("calcBtn").innerText = lang.calculate;
      document.getElementById("clearBtn").innerText = lang.clear;
      document.getElementById("saveBtn").innerText = lang.save;

      document.getElementById("calcBtn2").innerText = lang.calculate;
      document.getElementById("clearBtn2").innerText = lang.clear;
      document.getElementById("saveBtn2").innerText = lang.save;

      // Repopulate periods with new language units
      populatePeriods();

      // Clear results on language change
      clearResult('resultRequired');
      clearResult('resultMaturity');
    }

    // Returns localized text fallback
    function getText(text) {
      // Basic example, extend as needed
      if (currentLanguage === 'si') {
        if (text === 'Please enter valid inputs') return 'කරුණාකර වලංගු දත්ත ඇතුලත් කරන්න';
      }
      return text;
    }

    // Initial setup
    setProduct('prarthana');

  </script>
</body>
</html>
