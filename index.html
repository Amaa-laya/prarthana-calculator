<!DOCTYPE html>
<!--
  NSB Savings Calculator ‚Äì Fully Updated (July 2025)
  ------------------------------------------------------------
  ‚úîÔ∏è Prarthana: yearly compounding (Required Deposit & Maturity)
  ‚úîÔ∏è Reality: monthly compounding with daily interest for partial months
  ‚úîÔ∏è Sidebar closes on product click
  ‚úîÔ∏è Speech toggle works to start/stop reading results
  ‚úîÔ∏è Reality tab label changed to "Installment Amount (LKR)"
-->
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NSB Savings Calculator</title>
<style>
  :root {
    --nsb: #f58220;
    --grey: #e0e0e0;
  }
  * {
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f5f5f5;
    display: flex;
    justify-content: center;
    min-height: 100vh;
    padding-top: 60px;
  }
  .container {
    background: #fff;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 4px 18px rgba(0,0,0,.1);
    max-width: 960px;
    width: 100%;
  }
  h2 {
    text-align: center;
    color: var(--nsb);
    margin: 0 0 22px;
  }
  .hamburger {
    position: fixed;
    top: 16px;
    left: 16px;
    font-size: 28px;
    background: #fff;
    color: var(--nsb);
    padding: 6px 12px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,.15);
    cursor: pointer;
    user-select: none;
    z-index: 1100;
  }
  .sidebar {
    position: fixed;
    left: -260px;
    top: 0;
    width: 260px;
    height: 100%;
    background: var(--nsb);
    padding-top: 60px;
    transition: left 0.3s ease;
    z-index: 1000;
  }
  .sidebar.open {
    left: 0;
  }
  .sidebar a {
    display: block;
    padding: 16px 24px;
    color: #fff;
    text-decoration: none;
    font-size: 18px;
    font-weight: bold;
  }
  .sidebar a:hover {
    background: #e06d0f;
  }
  .tabs {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 18px;
  }
  .tab {
    background: var(--grey);
    padding: 10px 24px;
    margin: 4px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
  }
  .tab.active {
    background: var(--nsb);
    color: #fff;
  }
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }
  form {
    border: 2px solid var(--nsb);
    padding: 20px;
    border-radius: 12px;
  }
  .grid {
    display: grid;
    grid-template-columns: minmax(120px, 1fr) 2fr;
    gap: 12px 20px;
    align-items: center;
  }
  @media(max-width: 540px) {
    .grid {
      grid-template-columns: 1fr;
    }
  }
  label {
    font-weight: 600;
  }
  input, select {
    width: 100%;
    padding: 10px;
    border: 2px solid var(--nsb);
    border-radius: 8px;
    font-size: 15px;
  }
  .btns {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  button {
    background: var(--nsb);
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 9px 14px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    user-select: none;
  }
  button:hover {
    background: #e06d0f;
  }
  .result {
    margin-top: 18px;
    min-height: 70px;
    font-size: 17px;
    font-weight: bold;
    color: #1976d2;
    white-space: pre-wrap;
  }
  #speechToggle {
    position: fixed;
    bottom: 18px;
    right: 18px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    font-size: 24px;
    background: var(--nsb);
    color: #fff;
    border: none;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,.15);
  }
  #speechToggle.off {
    background: #aaa;
  }
</style>
</head>
<body>

<!-- Sidebar hamburger -->
<span class="hamburger" onclick="toggleSidebar()">‚ò∞</span>

<!-- Sidebar -->
<nav id="sidebar" class="sidebar">
  <a href="#" onclick="setProduct('prarthana')">Prarthana</a>
  <a href="#" onclick="setProduct('reality')">Reality</a>
</nav>

<!-- Main container -->
<div class="container">
  <h2 id="title">NSB Prarthana Savings Calculator</h2>

  <!-- Tabs -->
  <div class="tabs">
    <div id="tabReqBtn" class="tab active" onclick="showTab('req')">ü™ô <span id="txtReq">Required Deposit</span></div>
    <div id="tabMatBtn" class="tab" onclick="showTab('mat')">üí∞ <span id="txtMat">Maturity Value</span></div>
  </div>

  <!-- Required Deposit Tab -->
  <div id="req" class="tab-content active">
    <form id="formReq" onsubmit="event.preventDefault(); calcReq()">
      <div class="grid">
        <label for="open">Opening Date:</label>
        <input id="open" type="date" onchange="updateMaturityDate()" required>
        
        <label for="per">Period:</label>
        <select id="per" onchange="updateMaturityDate()"></select>
        
        <label for="mdate">Maturity Date:</label>
        <input id="mdate" type="date" disabled>
        
        <label for="target">Target Amount (LKR):</label>
        <input id="target" type="number" min="0" step="0.01" required>
        
        <label for="rate">Interest Rate (%):</label>
        <input id="rate" type="number" min="0" max="100" step="0.01" required>
      </div>
      <div class="btns">
        <button type="submit">üßÆ Calculate</button>
        <button type="button" onclick="resetAll()">üßπ Clear</button>
        <button type="button" onclick="printRes('res1')">üñ®Ô∏è Print</button>
        <button type="button" onclick="mailRes('res1')">üìß Email</button>
      </div>
    </form>
    <div id="res1" class="result"></div>
  </div>

  <!-- Maturity Value Tab -->
  <div id="mat" class="tab-content">
    <form id="formMat" onsubmit="event.preventDefault(); calcMat()">
      <div class="grid">
        <label for="open2">Opening Date:</label>
        <input id="open2" type="date" onchange="updateMaturityDateMat()" required>
        
        <label for="per2">Period:</label>
        <select id="per2" onchange="updateMaturityDateMat()"></select>
        
        <label for="mdate2">Maturity Date:</label>
        <input id="mdate2" type="date" disabled>
        
        <label for="amt" id="lblAmt">Installment Amount (LKR):</label>
        <input id="amt" type="number" min="0" step="0.01" required>
        
        <label for="rate2">Interest Rate (%):</label>
        <input id="rate2" type="number" min="0" max="100" step="0.01" required>
      </div>
      <div class="btns">
        <button type="submit">üßÆ Calculate</button>
        <button type="button" onclick="resetAll()">üßπ Clear</button>
        <button type="button" onclick="printRes('res2')">üñ®Ô∏è Print</button>
        <button type="button" onclick="mailRes('res2')">üìß Email</button>
      </div>
    </form>
    <div id="res2" class="result"></div>
  </div>
</div>

<!-- Speech toggle button -->
<button id="speechToggle" title="Toggle speech" onclick="toggleSpeech()">üîä</button>

<script>
  const $ = id => document.getElementById(id);

  // Global product selection: 'prarthana' or 'reality'
  let product = 'prarthana';

  // Speech toggle state
  let speechOn = true;

  // Period options
  const prarthanaYears = [3, 5, 10, 15, 20];
  const realityMonths = [12, 24, 36, 48, 60];

  // Toggle sidebar visibility
  function toggleSidebar() {
    $('sidebar').classList.toggle('open');
  }

  // Close sidebar
  function closeSidebar() {
    $('sidebar').classList.remove('open');
  }

  // Set product (Prarthana or Reality), update UI and close sidebar
  function setProduct(p) {
    product = p;
    closeSidebar();

    // Update title
    $('title').textContent = product === 'prarthana' ? 'NSB Prarthana Savings Calculator' : 'NSB Reality Savings Calculator';

    // Update label for "Installment Amount" in Reality
    $('lblAmt').textContent = product === 'prarthana' ? 'Deposit Amount (LKR):' : 'Installment Amount (LKR):';

    populatePeriods();
    resetAll();
    showTab('req');
  }

  // Populate period selects based on product
  function populatePeriods() {
    const perSelect = $('per');
    const perSelect2 = $('per2');
    perSelect.innerHTML = '';
    perSelect2.innerHTML = '';

    if (product === 'prarthana') {
      prarthanaYears.forEach(year => {
        const opt1 = document.createElement('option');
        opt1.value = year;
        opt1.textContent = year + (year === 1 ? ' year' : ' years');
        perSelect.appendChild(opt1);

        const opt2 = opt1.cloneNode(true);
        perSelect2.appendChild(opt2);
      });
    } else {
      realityMonths.forEach(month => {
        const opt1 = document.createElement('option');
        opt1.value = month;
        opt1.textContent = month + (month === 1 ? ' month' : ' months');
        perSelect.appendChild(opt1);

        const opt2 = opt1.cloneNode(true);
        perSelect2.appendChild(opt2);
      });
    }

    updateMaturityDate();
    updateMaturityDateMat();
  }

  // Update maturity date in Required Deposit tab
  function updateMaturityDate() {
    const openDateStr = $('open').value;
    const period = parseInt($('per').value, 10);
    if (!openDateStr || !period) {
      $('mdate').value = '';
      return;
    }
    const openDate = new Date(openDateStr);
    let maturityDate = new Date(openDate);

    if (product === 'prarthana') {
      maturityDate.setFullYear(maturityDate.getFullYear() + period);
    } else {
      // Add months and calculate partial days for Reality
      const months = period;
      maturityDate.setMonth(maturityDate.getMonth() + months);
    }

    // Format to yyyy-mm-dd
    $('mdate').value = maturityDate.toISOString().slice(0, 10);
  }

  // Update maturity date in Maturity Value tab
  function updateMaturityDateMat() {
    const openDateStr = $('open2').value;
    const period = parseInt($('per2').value, 10);
    if (!openDateStr || !period) {
      $('mdate2').value = '';
      return;
    }
    const openDate = new Date(openDateStr);
    let maturityDate = new Date(openDate);

    if (product === 'prarthana') {
      maturityDate.setFullYear(maturityDate.getFullYear() + period);
    } else {
      maturityDate.setMonth(maturityDate.getMonth() + period);
    }

    $('mdate2').value = maturityDate.toISOString().slice(0, 10);
  }

  // Calculate Required Deposit
  function calcReq() {
    const openDateStr = $('open').value;
    const period = parseInt($('per').value, 10);
    const targetAmount = parseFloat($('target').value);
    const ratePercent = parseFloat($('rate').value);

    if (!openDateStr || isNaN(period) || isNaN(targetAmount) || isNaN(ratePercent)) {
      alert('Please fill all fields correctly.');
      return;
    }

    const openDate = new Date(openDateStr);

    let principal;

    if (product === 'prarthana') {
      // Yearly compounding
      const rate = ratePercent / 100;
      principal = targetAmount / Math.pow(1 + rate, period);
    } else {
      // Reality: monthly compounding with daily interest calculation
      const rateMonthly = ratePercent / 100;
      // Calculate exact days difference between open and maturity date
      const maturityDate = new Date(openDate);
      maturityDate.setMonth(maturityDate.getMonth() + period);
      const diffMs = maturityDate - openDate;
      const diffDays = diffMs / (1000 * 60 * 60 * 24);

      // Calculate monthly + daily effective interest rate for exact period
      const monthsWhole = Math.floor(diffDays / 30);
      const daysPartial = diffDays % 30;

      // Effective interest rate for whole months
      const totalForWholeMonths = Math.pow(1 + rateMonthly, monthsWhole);
      // Daily interest rate (assumed monthly rate / 30 days)
      const rateDaily = rateMonthly / 30;
      // Effective interest rate for partial days
      const totalForPartialDays = Math.pow(1 + rateDaily, daysPartial);

      // Combined growth factor
      const totalGrowth = totalForWholeMonths * totalForPartialDays;

      principal = targetAmount / totalGrowth;
    }

    principal = Math.max(principal, 0);

    const maturityDateStr = $('mdate').value || 'N/A';

    const result = 
      `Opening Date: ${openDateStr}\n` +
      `Maturity Date: ${maturityDateStr}\n` +
      `Period: ${period} ${product === 'prarthana' ? (period === 1 ? 'year' : 'years') : (period === 1 ? 'month' : 'months')}\n` +
      `Target Amount: LKR ${targetAmount.toFixed(2)}\n` +
      `Interest Rate: ${ratePercent.toFixed(2)}% ${product === 'prarthana' ? 'per year' : 'per month'}\n` +
      `Required Deposit: LKR ${principal.toFixed(2)}`;

    $('res1').textContent = result;

    if (speechOn) speakResult(result);
  }

  // Calculate Maturity Value
  function calcMat() {
    const openDateStr = $('open2').value;
    const period = parseInt($('per2').value, 10);
    const installment = parseFloat($('amt').value);
    const ratePercent = parseFloat($('rate2').value);

    if (!openDateStr || isNaN(period) || isNaN(installment) || isNaN(ratePercent)) {
      alert('Please fill all fields correctly.');
      return;
    }

    const openDate = new Date(openDateStr);

    let maturityValue;

    if (product === 'prarthana') {
      // Yearly compounding for lump sum
      const rate = ratePercent / 100;
      maturityValue = installment * Math.pow(1 + rate, period);
    } else {
      // Reality: monthly compounding for installments, with daily interest for partial months
      const rateMonthly = ratePercent / 100;
      // Calculate maturity date
      const maturityDate = new Date(openDate);
      maturityDate.setMonth(maturityDate.getMonth() + period);

      // Calculate total months and days difference
      const diffMs = maturityDate - openDate;
      const diffDays = diffMs / (1000 * 60 * 60 * 24);
      const monthsWhole = Math.floor(diffDays / 30);
      const daysPartial = diffDays % 30;

      // Sum future value of each installment compounded monthly
      // Formula for future value of annuity compounded monthly:
      // FV = P * [ ((1+r)^n - 1) / r ]
      // Here, P = installment, r = monthly rate, n = months

      // Calculate FV of full months installments
      const r = rateMonthly;
      const n = monthsWhole;

      if (r === 0) {
        maturityValue = installment * n;
      } else {
        maturityValue = installment * ((Math.pow(1 + r, n) - 1) / r);
      }

      // Now add interest for partial days on last installment
      // Calculate daily interest rate
      const dailyRate = r / 30;

      // Add interest for partial days on last installment
      maturityValue += installment * Math.pow(1 + dailyRate, daysPartial);
    }

    maturityValue = Math.max(maturityValue, 0);

    const maturityDateStr = $('mdate2').value || 'N/A';

    const result =
      `Opening Date: ${openDateStr}\n` +
      `Maturity Date: ${maturityDateStr}\n` +
      `Period: ${period} ${product === 'prarthana' ? (period === 1 ? 'year' : 'years') : (period === 1 ? 'month' : 'months')}\n` +
      `${product === 'prarthana' ? 'Deposit Amount' : 'Installment Amount'}: LKR ${installment.toFixed(2)}\n` +
      `Interest Rate: ${ratePercent.toFixed(2)}% ${product === 'prarthana' ? 'per year' : 'per month'}\n` +
      `Maturity Value: LKR ${maturityValue.toFixed(2)}`;

    $('res2').textContent = result;

    if (speechOn) speakResult(result);
  }

  // Reset all inputs and results
  function resetAll() {
    // Reset forms
    $('formReq').reset();
    $('formMat').reset();

    // Clear results
    $('res1').textContent = '';
    $('res2').textContent = '';
  }

  // Show tab by id ('req' or 'mat')
  function showTab(tab) {
    // Tabs buttons
    $('tabReqBtn').classList.toggle('active', tab === 'req');
    $('tabMatBtn').classList.toggle('active', tab === 'mat');

    // Tab contents
    $('req').classList.toggle('active', tab === 'req');
    $('mat').classList.toggle('active', tab === 'mat');
  }

  // Print results of given id
  function printRes(id) {
    const content = $(id).textContent.trim();
    if (!content) {
      alert('No result to print.');
      return;
    }
    const printWindow = window.open('', '', 'height=400,width=600');
    printWindow.document.write('<pre style="font-family:Arial; font-size:16px;">' + content + '</pre>');
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
  }

  // Email results using mailto (simple approach)
  function mailRes(id) {
    const content = $(id).textContent.trim();
    if (!content) {
      alert('No result to email.');
      return;
    }
    const subject = encodeURIComponent('NSB Savings Calculator Result');
    const body = encodeURIComponent(content);
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
  }

  // Speech synthesis to read results
  function speakResult(text) {
    if (!window.speechSynthesis) return;

    // Cancel any ongoing speech
    window.speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(text);
    window.speechSynthesis.speak(utterance);
  }

  // Toggle speech on/off
  function toggleSpeech() {
    speechOn = !speechOn;

    if (!speechOn) {
      // Stop any speaking immediately
      window.speechSynthesis.cancel();
      $('speechToggle').classList.add('off');
    } else {
      $('speechToggle').classList.remove('off');
      // Optionally speak current visible result again on toggle on
      const res1 = $('res1').textContent.trim();
      const res2 = $('res2').textContent.trim();
      if (res1) speakResult(res1);
      else if (res2) speakResult(res2);
    }
  }

  // Initialize app
  function init() {
    populatePeriods();
    setProduct(product);
    showTab('req');
    speechOn = true;
    $('speechToggle').classList.remove('off');
  }

  // Start initialization on page load
  window.onload = init;

</script>

</body>
</html>
