<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NSB Savings Calculator</title>
  <style>
    /* Color variables */
    :root {
      --nsb: #f58220;
      --grey: #e0e0e0;
      --blue: #1976d2;
      --dark: #444;
      --bg-light: #f5f5f5;
      --bg-dark: #1e1e1e;
      --text-light: #000;
      --text-dark: #fff;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: var(--bg-light);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      min-height: 100vh;
      padding-top: 60px;
      transition: background 0.3s ease, color 0.3s ease;
    }
    body.dark-mode {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.1);
      max-width: 960px;
      width: 100%;
    }
    body.dark-mode .container {
      background: #2c2c2c;
    }
    h2 {
      text-align: center;
      color: var(--nsb);
      margin-bottom: 20px;
    }
    .hamburger {
      position: fixed;
      top: 16px;
      left: 16px;
      font-size: 28px;
      background: #fff;
      color: var(--nsb);
      padding: 6px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      user-select: none;
      z-index: 1100;
    }
    .sidebar {
      position: fixed;
      left: -260px;
      top: 0;
      width: 260px;
      height: 100%;
      background: var(--nsb);
      padding-top: 60px;
      transition: left 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }
    .sidebar.open {
      left: 0;
    }
    .sidebar a {
      display: block;
      padding: 16px 24px;
      color: #fff;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
    }
    .sidebar a:hover {
      background: #e06d0f;
    }
    .sidebar .dark-toggle {
      display: block;
      padding: 16px 24px;
      background: #222;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      text-align: center;
    }
    /* NSB logo styling */
    .nsb-logo {
      text-align: center;
      margin-bottom: 16px;
    }
    .nsb-logo img {
      width: 80px;
      height: auto;
    }
    .tabs {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 18px;
      gap: 8px;
    }
    .tab {
      background: var(--grey);
      padding: 10px 24px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      user-select: none;
      font-weight: bold;
      color: var(--dark);
      font-family: "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", Arial, sans-serif;
    }
    .tab.active {
      background: var(--nsb);
      color: #fff;
    }
    .tab-content {
      display: none;
      /* remove margin bottom, spacing handled by row */
    }
    .tab-content.active {
      display: block;
    }
    form {
      border: 2px solid var(--nsb);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 16px;
      font-family: "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", Arial, sans-serif;
      background: #fff;
    }
    body.dark-mode form {
      background: #3a3a3a;
      border-color: #e67e22;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 4px;
      border-radius: 6px;
      border: 1px solid #ccc;
      outline-offset: 2px;
      font-family: inherit;
    }
    input:focus, select:focus {
      border-color: var(--nsb);
      outline: none;
      box-shadow: 0 0 5px var(--nsb);
    }
    button {
      background-color: var(--nsb);
      color: #fff;
      border: none;
      cursor: pointer;
      margin-top: 10px;
      user-select: none;
      transition: background-color 0.3s ease;
      font-family: inherit;
    }
    button:hover {
      background-color: #e06d0f;
    }
    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .button-row button {
      flex: 1;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      color: var(--blue);
      white-space: pre-wrap;
      font-family: inherit;
    }
    .toolbar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
      align-items: center;
      gap: 10px;
    }
    .sound-icon {
      font-size: 28px;
      cursor: pointer;
      color: var(--blue);
      user-select: none;
      transition: color 0.3s ease;
      font-family: "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", Arial, sans-serif;
    }
    .sound-icon.off {
      color: var(--dark);
      opacity: 0.5;
    }
    .language-toggle {
      font-size: 12px;
      background: var(--grey);
      padding: 4px 8px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      user-select: none;
      width: auto;
      font-family: inherit;
    }

    /* NEW: container for the two forms side by side */
    .forms-row {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap; /* allows wrapping on small screens */
    }
    .forms-row > div {
      flex: 1 1 400px; /* flex-grow, flex-shrink, basis */
      min-width: 280px; /* prevents shrinking too small */
      max-width: 480px; /* max width for each form */
    }

    @media (max-width: 768px) {
      .forms-row {
        flex-direction: column;
        gap: 30px;
      }
    }

    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      input, button, select {
        font-size: 16px;
        width: 100%;
        margin-bottom: 10px;
      }
      .tabs {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- Hamburger icon to toggle sidebar -->
  <span class="hamburger" onclick="toggleSidebar()">☰</span>

  <!-- Sidebar navigation for product selection -->
  <nav id="sidebar" class="sidebar">
    <div class="nsb-logo">
      <img src="/assets/nsb.png" alt="NSB Logo" />
    </div>
    <a href="#" onclick="setProduct('prarthana'); toggleSidebar(); return false;">Prarthana</a>
    <a href="#" onclick="setProduct('reality'); toggleSidebar(); return false;">Reality</a>
    <span class="dark-toggle" onclick="toggleDarkMode()">🌓 Dark Mode</span>
  </nav>

  <div class="container">
    <!-- Title changes based on product & language -->
    <h2 id="title">NSB Prarthana Savings Calculator</h2>

    <div class="toolbar">
      <!-- Language toggle button -->
      <button class="language-toggle" onclick="toggleLanguage()" id="langBtn">සිංහල</button>
      <!-- Sound toggle icon -->
      <span id="soundIcon" class="sound-icon" onclick="toggleSound()">🔊</span>
    </div>

    <!-- Tabs for calculator forms -->
    <div class="tabs">
      <div class="tab active" id="tabRequired" onclick="showTab('required')">🪙 Required Deposit</div>
      <div class="tab" id="tabMaturity" onclick="showTab('maturity')">💰 Maturity Value</div>
    </div>

    <div class="forms-row">
      <!-- Required Deposit Form -->
      <div id="required" class="tab-content active">
        <form id="formRequired" onsubmit="event.preventDefault(); calculateRequired();">
          <label for="open" id="labelOpen">Opening Date</label>
          <input id="open" type="date" required onchange="updateMaturityDate()" />

          <label for="period" id="labelPeriod">Period</label>
          <select id="period" required onchange="updateMaturityDate()"></select>

          <label for="mdate" id="labelMdate">Maturity Date</label>
          <input id="mdate" type="date" disabled />

          <label for="target" id="labelTarget">Target Amount (LKR)</label>
          <input id="target" type="number" step="0.01" min="0" required />

          <label for="rate" id="rateLabel">Interest Rate (% per year)</label>
          <input id="rate" type="number" step="0.01" min="0" required />

          <div class="button-row">
            <button type="submit" id="calcBtn">🧮 Calculate</button>
            <button type="reset" onclick="clearResult('resultRequired')" id="clearBtn">🧹 Clear</button>
            <button type="button" onclick="saveFormAsPDF('formRequired', 'resultRequired', 'NSB_Prarthana_Savings_Calculator')" id="saveBtn">💾 Save as PDF</button>
          </div>
        </form>
        <div class="result" id="resultRequired"></div>
      </div>

      <!-- Maturity Value Form -->
      <div id="maturity" class="tab-content">
        <form id="formMaturity" onsubmit="event.preventDefault(); calculateMaturity();">
          <label for="open2" id="labelOpen2">Opening Date</label>
          <input id="open2" type="date" required onchange="updateMaturityDate2()" />

          <label for="period2" id="labelPeriod2">Period</label>
          <select id="period2" required onchange="updateMaturityDate2()"></select>

          <label for="mdate2" id="labelMdate2">Maturity Date</label>
          <input id="mdate2" type="date" disabled />

          <label for="installment" id="installmentLabel">Deposit Amount (LKR)</label>
          <input id="installment" type="number" step="0.01" min="0" required />

          <label for="rate2" id="rateLabel2">Interest Rate (% per year)</label>
          <input id="rate2" type="number" step="0.01" min="0" required />

          <div class="button-row">
            <button type="submit" id="calcBtn2">🧮 Calculate</button>
            <button type="reset" onclick="clearResult('resultMaturity')" id="clearBtn2">🧹 Clear</button>
            <button type="button" onclick="saveFormAsPDF('formMaturity', 'resultMaturity', 'NSB_Reality_Savings_Calculator')" id="saveBtn2">💾 Save as PDF</button>
          </div>
        </form>
        <div class="result" id="resultMaturity"></div>
      </div>
    </div>
  </div>

  <!-- jsPDF Library for saving PDFs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    let currentProduct = 'prarthana';  // "prarthana" or "reality"
    let soundOn = true;
    let currentLanguage = 'en';

    // Period options by product
    const periods = {
      prarthana: [3, 5, 10, 15, 20],   // years
      reality: [12, 24, 36, 48, 60]    // months
    };

    // Translations for labels and text
    const labels = {
      en: {
        titlePrarthana: "NSB Prarthana Savings Calculator",
        titleReality: "NSB Reality Savings Calculator",
        depositLabel: "Deposit Amount (LKR)",
        monthlyLabel: "Monthly Installment (LKR)",
        requiredTab: "Required Deposit",
        maturityTab: "Maturity Value",
        calculate: "Calculate",
        clear: "Clear",
        save: "Save as PDF",
        rate: "Interest Rate (% per year)",
        target: "Target Amount (LKR)",
        openDate: "Opening Date",
        period: "Period",
        maturityDate: "Maturity Date"
      },
      si: {
        titlePrarthana: "NSB ප්‍රාර්ථනා අරමුදල් ගණකය",
        titleReality: "NSB රියාලිටි අරමුදල් ගණකය",
        depositLabel: "තැන්පතු මුදල (රු.)",
        monthlyLabel: "මාසික වාරිකය (රු.)",
        requiredTab: "අවශ්‍ය තැන්පතු",
        maturityTab: "මූල්‍ය අගය",
        calculate: "ගණනය කරන්න",
        clear: "පිරිසිදු කරන්න",
        save: "PDF ලෙස සුරකින්න",
        rate: "පිළිබඳ පොලී අනුපාතය (වසරකට %)",
        target: "ඉලක්ක මුදල (රු.)",
        openDate: "ආරම්භක දිනය",
        period: "කාලය",
        maturityDate: "මූල්‍ය දිනය"
      }
    };

    // Sidebar toggle
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("open");
    }

    // Toggle sound on/off with speech feedback
    function toggleSound() {
      soundOn = !soundOn;
      const icon = document.getElementById("soundIcon");
      icon.classList.toggle("off", !soundOn);
      speak(soundOn ? (currentLanguage === 'en' ? "Sound On" : "ශබ්දය සක්‍රීයයි") : (currentLanguage === 'en' ? "Sound Off" : "ශබ්දය නිවැටයි"));
    }

    // Speak text using Web Speech API
    function speak(text) {
      if (!soundOn) return;
      const synth = window.speechSynthesis;
      if (synth.speaking) synth.cancel();
      const utter = new SpeechSynthesisUtterance(text);
      synth.speak(utter);
    }

    // Switch between "prarthana" and "reality" products
    function setProduct(product) {
      currentProduct = product;

      // Update title
      const lang = labels[currentLanguage];
      document.getElementById("title").innerText = product === 'prarthana' ? lang.titlePrarthana : lang.titleReality;

      // Update installment label based on product
      document.getElementById("installmentLabel").innerText = product === 'prarthana' ? lang.depositLabel : lang.monthlyLabel;

      // Reset forms and results
      document.getElementById("formRequired").reset();
      document.getElementById("formMaturity").reset();
      clearResult('resultRequired');
      clearResult('resultMaturity');

      // Populate period dropdowns for the selected product
      populatePeriods();
      updateMaturityDate();
      updateMaturityDate2();

      // Update UI labels text for current language
      updateLanguage();
    }

    // Show selected tab content and mark tab active
    function showTab(id) {
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));

      document.getElementById(id).classList.add('active');
      document.getElementById('tab' + capitalizeFirstLetter(id)).classList.add('active');
    }

    // Capitalize first letter helper
    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // Populate period select inputs depending on product
    function populatePeriods() {
      const periodSelects = [document.getElementById('period'), document.getElementById('period2')];
      periodSelects.forEach(select => {
        select.innerHTML = ''; // clear options
        periods[currentProduct].forEach(p => {
          let option = document.createElement('option');
          if (currentProduct === 'prarthana') {
            option.value = p;
            option.text = p + ' Years';
          } else {
            option.value = p;
            option.text = p + ' Months';
          }
          select.appendChild(option);
        });
      });
    }

    
    // ---------------- Maturity Date helpers ------------------
    function updateMaturityDate() {
      const openVal   = document.getElementById("open").value;
      const periodVal = document.getElementById("period").value;
      if (!openVal || !periodVal) {
        document.getElementById("mdate").value = "";
        return;
      }
      const open   = new Date(openVal);
      const period = parseInt(periodVal);

      if (currentProduct === 'prarthana') {
        open.setFullYear(open.getFullYear() + period);
      } else {
        open.setMonth(open.getMonth() + period);
      }
      document.getElementById("mdate").value = open.toISOString().slice(0, 10);
    }

    function updateMaturityDate2() {
      const openVal   = document.getElementById("open2").value;
      const periodVal = document.getElementById("period2").value;
      if (!openVal || !periodVal) {
        document.getElementById("mdate2").value = "";
        return;
      }
      const open   = new Date(openVal);
      const period = parseInt(periodVal);

      if (currentProduct === 'prarthana') {
        open.setFullYear(open.getFullYear() + period);
      } else {
        open.setMonth(open.getMonth() + period);
      }
      document.getElementById("mdate2").value = open.toISOString().slice(0, 10);
    }

    // ---------------- Calculations ------------------
    function calculateRequired() {
      const target = parseFloat(document.getElementById("target").value);
      const rate   = parseFloat(document.getElementById("rate").value) / 100; // annual -> decimal
      const period = parseInt(document.getElementById("period").value);
      if (isNaN(target) || isNaN(rate) || isNaN(period)) {
        alert("Please enter valid values.");
        return;
      }

      let result = "";
      if (currentProduct === 'prarthana') {
        // --- Prarthana: yearly compounding (lump‑sum) ---
        // P = Target / (1 + r)^t
        const P = target / Math.pow(1 + rate, period);
        result = `Required Deposit Today: LKR ${P.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
      } else {
        // --- Reality: Monthly deposits (annuity‑due) ---
        // M = Target * r / ((1+r)^n - 1) / (1+r)
        const r = rate / 12;           // monthly rate
        const n = period;              // number of months
        const M = target * r / (Math.pow(1 + r, n) - 1) / (1 + r);
        result = `Monthly Installment Needed: LKR ${M.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
      }

      document.getElementById("resultRequired").innerText = result;
      speak(result);
    }

    function calculateMaturity() {
      const deposit = parseFloat(document.getElementById("installment").value);
      const rate    = parseFloat(document.getElementById("rate2").value) / 100;
      const period  = parseInt(document.getElementById("period2").value);
      if (isNaN(deposit) || isNaN(rate) || isNaN(period)) {
        alert("Please enter valid values.");
        return;
      }

      let result = "";
      if (currentProduct === 'prarthana') {
        // --- Prarthana: yearly compounding ---
        // A = P * (1 + r)^t
        const A = deposit * Math.pow(1 + rate, period);
        result = `Maturity Value: LKR ${A.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
      } else {
        // --- Reality: Monthly deposits (annuity‑due) ---
        // A = M * ((1+r)^n - 1) / r * (1+r)
        const r = rate / 12;
        const n = period;
        const A = deposit * (Math.pow(1 + r, n) - 1) / r * (1 + r);
        result = `Maturity Value: LKR ${A.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
      }

      document.getElementById("resultMaturity").innerText = result;
      speak(result);
    }

      document.getElementById('resultMaturity').innerText = resultText;
      speak(resultText);
    
    // Clear result text
    function clearResult(id) {
      document.getElementById(id).innerText = '';
    }

    // Save form and result as PDF using jsPDF
    function saveFormAsPDF(formId, resultId, fileName) {
      const form = document.getElementById(formId);
      const result = document.getElementById(resultId).innerText;

      const pdf = new jsPDF();

      pdf.setFontSize(18);
      pdf.setTextColor('#f58220');
      pdf.text(fileName.replace(/_/g, ' '), 10, 20);

      pdf.setFontSize(12);
      pdf.setTextColor('#000');

      // Collect form data
      let y = 30;
      for (const element of form.elements) {
        if (element.tagName.toLowerCase() === 'button' || element.disabled) continue;
        if (element.type === 'submit' || element.type === 'reset' || element.type === 'button') continue;

        const label = form.querySelector(`label[for="${element.id}"]`);
        const labelText = label ? label.innerText : element.id;

        pdf.text(`${labelText}: ${element.value}`, 10, y);
        y += 10;
      }

      y += 10;
      pdf.setFontSize(14);
      pdf.setTextColor('#1976d2');
      pdf.text('Result:', 10, y);
      y += 8;

      pdf.setFontSize(12);
      pdf.setTextColor('#000');
      pdf.text(result, 10, y);

      pdf.save(fileName + '.pdf');
    }

    // Toggle dark mode
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }

    // Toggle language between English and Sinhala
    function toggleLanguage() {
      currentLanguage = currentLanguage === 'en' ? 'si' : 'en';
      updateLanguage();
    }

    // Update all UI text based on currentLanguage and currentProduct
    function updateLanguage() {
      const lang = labels[currentLanguage];

      document.getElementById('title').innerText = currentProduct === 'prarthana' ? lang.titlePrarthana : lang.titleReality;
      document.getElementById('installmentLabel').innerText = currentProduct === 'prarthana' ? lang.depositLabel : lang.monthlyLabel;
      document.getElementById('labelOpen').innerText = lang.openDate;
      document.getElementById('labelOpen2').innerText = lang.openDate;
      document.getElementById('labelPeriod').innerText = lang.period;
      document.getElementById('labelPeriod2').innerText = lang.period;
      document.getElementById('labelMdate').innerText = lang.maturityDate;
      document.getElementById('labelMdate2').innerText = lang.maturityDate;
      document.getElementById('rateLabel').innerText = lang.rate;
      document.getElementById('rateLabel2').innerText = lang.rate;
      document.getElementById('labelTarget').innerText = lang.target;

      document.getElementById('tabRequired').innerText = `🪙 ${lang.requiredTab}`;
      document.getElementById('tabMaturity').innerText = `💰 ${lang.maturityTab}`;

      document.getElementById('calcBtn').innerText = `🧮 ${lang.calculate}`;
      document.getElementById('clearBtn').innerText = `🧹 ${lang.clear}`;
      document.getElementById('saveBtn').innerText = `💾 ${lang.save}`;

      document.getElementById('calcBtn2').innerText = `🧮 ${lang.calculate}`;
      document.getElementById('clearBtn2').innerText = `🧹 ${lang.clear}`;
      document.getElementById('saveBtn2').innerText = `💾 ${lang.save}`;

      document.getElementById('langBtn').innerText = currentLanguage === 'en' ? 'සිංහල' : 'English';
    }

    // Initial setup on page load
    window.onload = () => {
      setProduct(currentProduct);
      updateLanguage();
    };
    // Format input fields with commas on blur and remove commas on focus
function setupInputFormatting(inputId) {
  const input = document.getElementById(inputId);
  if (!input) return;

  input.addEventListener('blur', () => {
    // Format number with commas on blur
    let val = input.value;
    if (!val) return;
    // Remove any existing commas
    val = val.replace(/,/g, '');
    // Check if valid number
    if (!isNaN(val)) {
      // Format with commas and keep decimals
      const parts = val.split('.');
      parts[0] = Number(parts[0]).toLocaleString('en-US');
      input.value = parts.join('.');
    }
  });

  input.addEventListener('focus', () => {
    // Remove commas on focus for easy editing
    let val = input.value;
    if (!val) return;
    val = val.replace(/,/g, '');
    input.value = val;
  });
}

// Setup formatting for all relevant inputs
function setupAllInputFormatting() {
  const inputIds = [
    'targetAmount', 'interestRate', 'periodInput',
    'monthlyInstallment', 'interestRateMaturity', 'periodInputMaturity'
  ];
  inputIds.forEach(id => setupInputFormatting(id));
}

// Call on page load
window.onload = () => {
  updateUI();
  setupAllInputFormatting();
};

</script>
</body>
</html>
